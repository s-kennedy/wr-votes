---
layout: "default"
---
{% comment %}
Try to eat up all leading slashes and the trailing .html . 
This is gross but it works.
{% endcomment %}
{% assign ward-id = page.url | replace: '.html', '' | split: '/' | last -%}
{% assign ward-info = site.data.internal.position-tags |
where:"PositionUniqueName",ward-id | first -%}


<h2>Who is Running? {{ ward-info.PositionDesc }}</h2>

<p>Attempt 09</p>

<p>Time now? {{ site.time }}</p>

{% assign municipal-info = site.data.internal.municipality-map |
where:"Name",ward-info.WardMunicipality | first %}
{% assign races-split = municipal-info.Races | split: ',' %}

{% for race in races-split %}
  {% if race == "_SELF" %}
    {% assign race-id = ward-id %}
  {% else %}
    {% assign race-id = race %}
  {% endif %}

  {% include list-nominees.html race-id=race-id %}

  {% assign events-list = site.data.sync.events 
    | where_exp:"ev", "ev.PositionIDList contains race-id" %}
    
  {% comment %}
    This will be a bit broken because of timezones, but 
    I am hoping that it won't matter much?
    No. It totally will. Suck.
  {% endcomment %}
  {% assign date-now = site.time | date: "%F" %}
  {% assign events-filtered = events-list 
    | where_exp:"ev", "ev.DateTimeStart >= date-now" %}

  <!-- Need to filter out events in the past. Suck! -->

  {% if events-filtered.size > 0 %}

    {% assign events-sorted = events-filtered | sort: "DateTimeStart" %}

    <h4>Upcoming Events</h4>
    
    <ul>
    {% for event in events-sorted %}

      <li>{{ event.DateTimeStart | date: "%a, %b %-d, %l:%M%P" }}:
      {% if event.URL %}
        <a href="{{ event.URL }}">{{ event.Title }}</a>
      {% else %}
        <strong>{{ event.Title }}</strong>
      {% endif -%}

      {% if event.Location %}
        , {{ event.Location }}
      {% endif %}
      </li>
    {% endfor %}
    </ul>
    
  {% endif %}


{% endfor %}


